---
title: "amelpool_admix"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{amelpool_admix}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(amel.poolseq)
library(dplyr)
library(ggplot2)
```

# ADMIXTURE Analysis

This vignette generates figures associated with admixture of US honey bee populations.

## Organize ADMIXTURE output
```{r}
plink3 <- read.table("plink.3.Q", header=F)
colnames(plink3) <- c("A", "M", "C") #pooled sequences from ancestral population
temp <- read.table("pca_rn.txt", header=T) #data.frame with population names
pop_plink <- cbind(plink3,temp)
pop_plink <- pop_plink[-grep("Ref", pop_plink$Management),]
```

## Average Ancestry per Population
Average ancestry by population and standard deviation.
```{r}
hbpop_admix <- pop_plink %>% group_by(Management) %>%
  summarize(avgA=mean(A), sdA=sd(A),
    avgC=mean(C), sdC=sd(C),
    avgM=mean(M), sdM=sd(M))
```

### Boxplot of ancestry by stock -> loop
```{r echo=FALSE}
sort.tbl <- with(pop_plink, pop_plink[order(pop_plink$Pop),]) #sort alphabetically by stock
ggplot(sort.tbl, aes(x=Pop, y=M)) + geom_boxplot(fill='#A29F9E', color="black") + 
labs(x="Management", y="Proportion") + coord_cartesian(ylim=c(0,1)) + 
theme_classic()
```

### Statistical significance -> loop
```{r}
  x <- aov(pop_plink$C~pop_plink$Management, data=pop_plink)
  TukeyHSD(x)
  x <- aov(pop_plink$M~pop_plink$Management, data=pop_plink)
```

## Produce Figure X: Ancestry by Pooled Sample
The dotted line represented in the figure represents the ancestry contribution at which AHB ancestry is reliably detectable.

```{r echo=FALSE}
anc.plot <- barplot(t(as.matrix(plink3)), 
                col=c("red", "black", "yellow"), 
                xlab="Sample", las=2,
                ylab="Ancestry", 
                legend=c("A", "M", "C"),
                args.legend=list(title="Ancestry", x="topright"))
abline(h=0.2, col="blue", lty=c(2), lwd=c(5))
```
